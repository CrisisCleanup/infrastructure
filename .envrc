#!/usr/bin/env bash
# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

# Team Shared direnv.
# See: https://github.com/direnv/direnv

# Enforces `set -euo pipefail` despite user local config.
strict_env

# forces "at least"
direnv_version 2.32.3

# User local additions.
source_env_if_exists .envrc.local

# Load rtx or asdf
if has rtx && has use_rtx; then
  use rtx
elif has asdf && has use_asdf; then
  log_status "rtx not found. Falling back to asdf."
  use asdf
else
  log_error "Neither rtx nor asdf are installed or integrated with direnv."
  log_error "For asdf: https://asdf-vm.com/"
  log_error "For rtx (asdf clone in rust): https://github.com/jdxcode/rtx"
fi

layout node

# Docker
export COMPOSE_DOCKER_CLI_BUILD=1
export DOCKER_BUILDKIT=1

# Set CCU_STAGE in .envrc.local (local|development|staging|production)
# Config values can then be overridden from the appropriate ".envrc.$CCU_STAGE" file.
#
#  All config keys available for override:
#   CHART__NAMESPACE
#   CHART__DOMAIN_NAME
#   CHART__API_IMAGE__REPOSITORY
#   CHART__API_IMAGE__TAG
#   CHART__API_IMAGE__PULL_POLICY
#   CHART__WEB_IMAGE__REPOSITORY
#   CHART__WEB_IMAGE__TAG
#   CHART__WEB_IMAGE__PULL_POLICY
#   CHART__FRONTEND__WEB__SPREAD
#   CHART__FRONTEND__WEB__REPLICA_COUNT
#   CHART__WSGI__SPREAD
#   CHART__WSGI__SCALING__MIN_REPLICAS
#   CHART__WSGI__SCALING__MAX_REPLICAS
#   CHART__ASGI__SPREAD
#   CHART__ASGI__SCALING__MIN_REPLICAS
#   CHART__ASGI__SCALING__MAX_REPLICAS
#   CHART__CELERY_BEAT__SPREAD
#   CHART__CELERY_BEAT__REPLICA_COUNT
#   CHART__CELERY__CELERY__QUEUES
#   CHART__CELERY__CELERY__SCALING__MIN_REPLICAS
#   CHART__CELERY__CELERY__SCALING__MAX_REPLICAS
#   CHART__CELERY__CELERY__SPREAD
#   CHART__CELERY__SIGNAL__QUEUES
#   CHART__CELERY__SIGNAL__SCALING__MIN_REPLICAS
#   CHART__CELERY__SIGNAL__SCALING__MAX_REPLICAS
#   CHART__CELERY__SIGNAL__SPREAD
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/LISTEN-PORTS
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/SSL-REDIRECT
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/SCHEME
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/TARGET-TYPE
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/TARGET-GROUP-ATTRIBUTES
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/HEALTHCHECK-PATH
#   CHART__INGRESS_ANNOTATIONS__ALB__INGRESS__KUBERNETES__IO/LOAD-BALANCER-ATTRIBUTES
#   API_STACK__ISOLATE_DATABASE
#   API_STACK__EKS__DEFAULT_SECRETS_ENCRYPTION
#   API_STACK__EKS__CORE_DNS_VERSION
#   API_STACK__EKS__KUBE_PROXY_VERSION
#   API_STACK__EKS__VPC_CNI_VERSION
#   API_STACK__EKS__K8S__VERSION
#   API_STACK__DATABASE__ENGINE_VERSION
#   API_STACK__DATABASE__IO_OPTIMIZED
#   CCU_STAGE
#   CDK_ENVIRONMENT__REGION
#   CDK_ENVIRONMENT__ACCOUNT
#   API__CONFIG__CELERY__ALWAYS_EAGER
#   API__CONFIG__DJANGO__ACCOUNT_ALLOW_REGISTRATION
#   API__CONFIG__DJANGO__ADMIN_URL
#   API__CONFIG__DJANGO__ALLOWED_HOSTS
#   API__CONFIG__DJANGO__CSRF_COOKIE_SECURE
#   API__CONFIG__DJANGO__SECURE_SSL_REDIRECT
#   API__CONFIG__DJANGO__SESSION_COOKIE_SECURE
#   API__CONFIG__DJANGO__EMAIL_BACKEND
#   API__CONFIG__DJANGO__SETTINGS_MODULE
#   API__CONFIG__DJANGO__MANDRILL__API_KEY
#   API__CONFIG__CCU__FORCE_DOCKER
#   API__CONFIG__CCU__API_URL
#   API__CONFIG__CCU__WEB_URL
#   API__CONFIG__CCU__NEWRELIC_DISABLE
#   API__CONFIG__CONNECT__INSTANCE_ID
#   API__CONFIG__ELASTIC_SEARCH__HOST
#   API__CONFIG__NEW_RELIC__CONFIG_FILE
#   API__CONFIG__PHONE__CHECK_TIMEZONE
#   API__CONFIG__SENTRY__TRACE_EXCLUDE_URLS
#   API__SECRETS__AWS__ACCESS_KEY_ID
#   API__SECRETS__AWS__SECRET_ACCESS_KEY
#   API__SECRETS__AWS__DEFAULT_REGION
#   API__SECRETS__AWS__DYNAMO_STAGE
#   API__SECRETS__CLOUDFRONT__PRIVATE_KEY
#   API__SECRETS__CLOUDFRONT__PUBLIC_KEY
#   API__SECRETS__JWT__PRIVATE_KEY
#   API__SECRETS__JWT__PUBLIC_KEY
#   API__SECRETS__CONNECT_FIRST__PASSWORD
#   API__SECRETS__POSTGRES__HOST
#   API__SECRETS__POSTGRES__PASSWORD
#   API__SECRETS__POSTGRES__DBNAME
#   API__SECRETS__POSTGRES__PORT
#   API__SECRETS__POSTGRES__USER
#   API__SECRETS__REDIS__HOST
#   API__SECRETS__REDIS__HOST_REPLICAS
#   API__SECRETS__ZENDESK__API_KEY
#   API__SECRETS__SAML__AWS_PROVIDER
#   API__SECRETS__SAML__AWS_ROLE


# Load environment config overrides.
export CCU_STAGE="${CCU_STAGE:-local}"
target_env=".envrc.${CCU_STAGE}"
source_env_if_exists "$target_env"